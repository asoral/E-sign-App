var w=(r,t,e)=>new Promise((I,i)=>{var c=a=>{try{n(e.next(a))}catch(B){i(B)}},E=a=>{try{n(e.throw(a))}catch(B){i(B)}},n=a=>a.done?I(a.value):Promise.resolve(a.value).then(c,E);n((e=e.apply(r,t)).next())});import{r as g,e as G,f as b,j as A,h as q}from"./index-Bs8bVgtG.js";import{S as j}from"./SignPad-C23qWZmz.js";import{Q as H,B as m,Y as p}from"./react-toastify.esm-C37bckj3.js";import{C as P}from"./ConfirmDeleteModal-CU6XQCgQ.js";import{L as x,e as v}from"./index-BbY9fkgA.js";import{C as y}from"./index-1dJBMb1S.js";import"./index-CwOAVtDj.js";import"./index-BlA-VN7q.js";var D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},N=function(t,e){return g.createElement(x,v({},t,{ref:e,icon:D}))},O=g.forwardRef(N),k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},_=function(t,e){return g.createElement(x,v({},t,{ref:e,icon:k}))},R=g.forwardRef(_),M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"},U=function(t,e){return g.createElement(x,v({},t,{ref:e,icon:M}))},z=g.forwardRef(U);const{Meta:$}=y,T=({refreshSignatures:r,setRefreshSignatures:t})=>{const e=G(b),[I,i]=g.useState([]),[c,E]=g.useState(!0),[n,a]=g.useState(null),[B,f]=g.useState(!1),[Q,h]=g.useState(null),u=g.useRef(null);g.useEffect(()=>{(e||r)&&w(void 0,null,function*(){try{const C=yield fetch(`/api/method/esign_app.api.get_signatures?user_mail=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}),l=yield C.json();C.status===200?(i(l.message.data),E(!1)):(a(l.message.data.toString()),E(!1))}catch(C){a("An error occurred while fetching signatures"),E(!1)}})},[e,r]);const s=o=>{h(o),f(!0)},d=()=>{f(!1),h(null)},K=o=>w(void 0,null,function*(){if(Q){try{const l=yield(yield fetch(`/api/method/esign_app.api.cancel_and_delete_esignature?user_mail=${e}&name=${o}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();l.message.status===200?(m.success("Deleted successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:p}),i(I.filter(Y=>Y.name!==o)),t(!0)):(m.error("Failed to delete signature",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:p}),console.error("Failed to delete signature:",l.message))}catch(C){m.error("Failed to delete signature",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:p}),console.error("Error deleting signature:",C)}f(!1),h(null)}}),L=o=>{if(u.current){const{scrollLeft:C,clientWidth:l,scrollWidth:Y}=u.current,S=o==="left"?Math.max(C-l,0):Math.min(C+l,Y-l);u.current.scrollTo({left:S,behavior:"smooth"})}};return c?A.jsx("div",{children:"Loading..."}):n?A.jsxs("div",{children:["Error: ",n]}):A.jsxs("div",{className:"relative mt-6 w-[70vw] mx-auto overflow-hidden",children:[I.length>=3&&A.jsxs(A.Fragment,{children:[A.jsx("button",{className:"scroll-button left absolute left-0 top-1/2 transform -translate-y-1/2 bg-white border border-gray-300 rounded-full shadow-md p-2 cursor-pointer z-10",onClick:()=>L("left"),children:A.jsx(R,{})}),A.jsx("button",{className:"scroll-button right absolute right-0 top-1/2 transform -translate-y-1/2 bg-white border border-gray-300 rounded-full shadow-md p-2 cursor-pointer z-10",onClick:()=>L("right"),children:A.jsx(z,{})})]}),A.jsx("div",{className:"flex gap-4 overflow-x-auto whitespace-nowrap scrollbar-hide",ref:u,children:I.map((o,C)=>A.jsx("div",{className:"inline-block",children:A.jsx(y,{style:{width:300},cover:A.jsx("img",{className:"mt-10 h-30",alt:`Signature ${C}`,src:o.sign_blob}),actions:[A.jsx(O,{onClick:()=>s(o)},"delete")],children:A.jsx($,{title:o.sign_name,description:new Date(o.creation).toLocaleString()})})},C))}),A.jsx(H,{limit:1}),Q&&A.jsx(P,{visible:B,name:Q.name,onCancel:d,onConfirm:K,message:"You sure? Wanna delete the sign?",module:"Signature"})]})};function rA(){const[r,t]=g.useState(null),[e,I]=g.useState(null),[i,c]=g.useState(null),[E,n]=g.useState(!1),a=G(q),B=G(b),f=s=>{n(!1),t(s),I(null)},Q=s=>{c(s.target.value)},h=()=>w(this,null,function*(){if(r=="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdYAAAD6CAYAAAAcA2ajAAAKHUlEQVR4Xu3VMQ0AAAzDsJU/6ZHI6QHoYU3KzhEgQIAAAQKZwLIlQwQIECBAgMAJqycgQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQIPObGAPuo15IPAAAAAElFTkSuQmCC"){m.error("Blank Sign-Pad",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:p});return}if(i==""||i==null){m.error("Enter Sign Name",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:p});return}const s={signature_data:r||e,signature_name:i,user_full_name:a,user_email:B};try{const K=yield(yield fetch("/api/method/esign_app.api.save_signature",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();K.message.status<300?(m.success("Sign Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:p}),I(null),t(null),c(""),n(!0)):alert("Error saving signature: "+K.message)}catch(d){console.error("Error:",d),alert("An error occurred while saving the signature")}}),u=s=>{n(!1),I(s),t(null)};return g.useEffect(()=>{const s=d=>{d.key==="Enter"&&(e!=null||r!==null)&&h()};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[e,r,i]),A.jsxs("div",{className:" mx-auto mt-8",children:[A.jsx(j,{onSave:f,onUpload:u}),r&&A.jsxs("div",{className:"bg-gray-200 p-4 mt-4",children:[A.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Signature Preview"}),A.jsx("img",{src:r,alt:"Signature",style:{maxWidth:"100%",height:"90px"},className:"border border-gray-300 rounded"}),A.jsxs("div",{className:"flex items-center space-x-2 mt-2 gap-1",children:[A.jsx("input",{type:"text",className:"border rounded px-4 py-2 h-10 focus:outline-none",placeholder:"Name of Signature",value:i||"",onChange:Q}),A.jsx("button",{onClick:h,className:"bg-white text-[#283C42] px-4 py-2 rounded border-2 border-[#283C42] hover:bg-[#283C42] hover:text-white hover:border-transparent transition-colors duration-300",children:"Save Signature"})]})]}),e&&!r&&A.jsxs("div",{className:"bg-gray-200 p-4 mt-4",children:[A.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Uploaded Image Preview"}),A.jsx("img",{src:e,alt:"Uploaded Image",style:{maxWidth:"100%",height:"auto"},className:"border border-gray-300 rounded"}),A.jsxs("div",{className:"flex items-center space-x-2 mt-2 gap-1",children:[A.jsx("input",{type:"text",className:"border rounded px-4 py-2 focus:outline-none",placeholder:"Name of Signature",onChange:Q}),A.jsx("button",{onClick:h,className:"bg-white text-[#283C42] px-4 py-2 rounded border-2 border-[#283C42] hover:bg-[#283C42] hover:text-white hover:border-transparent transition-colors duration-300",children:"Save Signature"})]})]}),A.jsx(T,{refreshSignatures:E,setRefreshSignatures:n})]})}export{rA as default};
