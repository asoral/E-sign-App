var w=(u,c,a)=>new Promise((s,d)=>{var f=p=>{try{o(a.next(p))}catch(l){d(l)}},h=p=>{try{o(a.throw(p))}catch(l){d(l)}},o=p=>p.done?s(p.value):Promise.resolve(p.value).then(f,h);o((a=a.apply(u,c)).next())});import{r as i,e as N,h as M,f as E,u as S,j as e}from"./index-Bs8bVgtG.js";import{Q as L,B as T,Y as k}from"./react-toastify.esm-C37bckj3.js";import{a4 as O}from"./index-BbY9fkgA.js";import{C as A}from"./ConfirmDeleteModal-CU6XQCgQ.js";const V=({setRefreshTempletes:u})=>{const[c,a]=i.useState(!1),[s,d]=i.useState(null),[f,h]=i.useState(null),o=N(M),p=N(E),l=S(),j=()=>{a(!0)},x=()=>{a(!1),d(null),h(null)},g=()=>{a(!1),d(null),h(null)},y=r=>{const t=r.target.value.replace(/\s{2,}/g," ");d(t),f&&h(null)},C=r=>{const n=Array.isArray(r)?r[0]:r;console.log("Here is the navigate function",n.name),l(`/templete/${n.name}`,{state:{templete:n}})},b=()=>w(void 0,null,function*(){if(!s)h("No value provided for templete name");else if(s.length<4)h("Enter a name with more than 4 characters");else{const r={templete_name:s,user_full_name:o,user_email:p};try{const t=yield(yield fetch("/api/method/esign_app.api.save_templete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();console.log(t),t.message.status<300?(T.success("Templete Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:k}),d(null),a(!1),u(m=>!m),C(t.message.data)):T.error("Error while saving templete",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:k})}catch(n){console.error("Error:",n),alert("An error occurred while saving the templete")}}});return i.useEffect(()=>{if(c){const r=n=>{n.key==="Enter"&&b()};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}}},[c,o,s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:j,children:"Add Templete"})}),e.jsx(O,{title:"Add Templete",open:c,onCancel:x,footer:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",children:"Save"},"save-button"),e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#ca2424] hover:bg-white hover:text-[#ca2424] transition-colors duration-300",onClick:g,children:"Cancel"},"cancel-button")]},"footer-buttons")],children:e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Templete Name"}),e.jsx("input",{className:"bg-[#d1e0e4] text-gray-700 focus:outline-none focus:shadow-outline border border-gray-300 rounded py-2 px-4 block w-full appearance-none",type:"text",value:s||"",onChange:y}),f&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:f})]})}),e.jsx(L,{limit:1})]})},D=({refreshTempletes:u,setRefreshTempletes:c})=>{const a=S(),s=N(E),[d,f]=i.useState([]),[h,o]=i.useState(!0),[p,l]=i.useState(null),[j,x]=i.useState(!1),[g,y]=i.useState(null);i.useEffect(()=>{(s||u)&&w(void 0,null,function*(){try{const m=yield fetch(`/api/method/esign_app.api.get_templetes?user_mail=${s}`,{method:"GET",headers:{"Content-Type":"application/json"}}),v=yield m.json();m.status===200?v.message.data.length>0?(f(v.message.data),o(!1)):(l("No templates found"),o(!1)):(l("Failed to fetch templates"),o(!1))}catch(m){l("An error occurred while fetching templates"),o(!1)}})},[s,u]);const C=t=>{a(`/templete/${t.name}`,{state:{templete:t}})},b=t=>w(void 0,null,function*(){if(g)try{const v=yield(yield fetch(`/api/method/esign_app.api.delete_esign_templete?user_mail=${s}&name=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();v.message.status===200?(f(d.filter(_=>_.name!==t)),c(!0),n()):(console.error("Failed to delete template:",v.message),l("Failed to delete template"))}catch(m){console.error("Error deleting template:",m),l("Error deleting template")}finally{x(!1)}}),r=t=>{y(t),x(!0)};function n(){T.error("Template Deleted successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:k})}return h?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"relative mt-6 min-w-[1000px] max-w-[1000px] mx-auto",children:[e.jsx("div",{className:"flex flex-wrap gap-5",children:d.map((t,m)=>e.jsxs("div",{className:"relative flex w-[200px] h-[100px]",children:[e.jsx("div",{className:"absolute top-2 right-2 cursor-pointer",onClick:()=>r(t),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash-2 text-red-600",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-2 14H7L5 6"}),e.jsx("path",{d:"M10 11v6"}),e.jsx("path",{d:"M14 11v6"}),e.jsx("path",{d:"M18 4l-1-1h-8L7 4"})]})}),e.jsxs("div",{className:"bg-[#283C42] text-white rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300 cursor-pointer p-4",style:{width:"200px",height:"100px"},onClick:()=>C(t),children:[e.jsx("h3",{className:"mt-2 font-bold text-ellipsis overflow-hidden whitespace-nowrap",children:t.templete_title}),e.jsx("p",{className:"text-sm text-gray-500 text-ellipsis overflow-hidden whitespace-nowrap",children:new Date(t.templete_created_at).toLocaleString()})]})]},m))}),g&&e.jsx(A,{visible:j,name:g.name,message:`Are you sure you want to delete the template "${g.templete_title}"?`,module:"Template",onCancel:()=>x(!1),onConfirm:b})]})};function R(){const[u,c]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(V,{setRefreshTempletes:c}),e.jsx(D,{refreshTempletes:u,setRefreshTempletes:c})]})}export{R as default};
